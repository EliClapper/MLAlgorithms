It has already been discussed how to obtain OLS estimates for simple linear regression. However, things become a bit more difficult if we want to estimate coefficients of multiple predictors simultaneously.
Let's take a look at the linear form when we have to estimate 2 regression coefficients and one intercept.
$$y_i = b_0 + b_1x_{1i} + b_2x_{2i} + \epsilon $$
**talk about matrix algebra and how to minimze RSS using matrix algebra**
https://stats.stackexchange.com/questions/46151/how-to-derive-the-least-square-estimator-for-multiple-linear-regression

Lets build a simple function that obtains OLS estimates and predictions for any number of numeric input variables using linear algebra. First we simulate data.

```{r}
Y <- rnorm(100, 100, 15)
X <- cbind(Y+rnorm(100, 100, 15), Y + rnorm(100, 100, 20))
```

Make function
```{r}
source("../Used_Functions.R") # load in function metrics().

OLS <- function(y, x){
  n <- length(y)         #number of observations
  nx <- ifelse(is.null(ncol(x)), length(x), nrow(x))
  
  if(nx != n){stop("lengths y and x differ")}
  
  x <- cbind(rep(1,n),x) #add intercept
  dfs <- n - ncol(x)     #degrees of freedom
  
  weights <- solve(t(x)%*%x) %*% t(x) %*% y #obtain weights using linear algebra
  
  y_pred <- weights[1] + rowSums(t(t(x[,2:ncol(x)])*weights[2:ncol(x)])) # obtain predicted values
  e <- y - y_pred # the errors to obtain Standard Errors of the estimates
  var_res <- as.numeric(t(e)%*%e/dfs) #estimate for residual variance
  varcov_weights <- var_res  * solve(t(x)%*%x)
  ses <- sqrt(diag(varcov_weights))
  
  t_vals <- weights/ses # obtain t-values
  p_vals <- pt(abs(t_vals), dfs, lower.tail = F) * 2 #probability of this t-value against central t-distribution with Df = dfs, two-tailed
  
  metricz <- metrics(y, y_pred) #obtain metrics of performance
  estimates <- cbind(weights, ses, t_vals, p_vals)
  colnames(estimates) <- c("weights", 'SEs', 't-value', 'p-value')
  rownames(estimates) <- c("b0", sprintf("b%d", 1:(ncol(x)-1)))

  return(list(estimates = estimates, `degrees of freedom` = dfs, metrics = metricz)) #return list
}
tt <- OLS(Y, X)
tt$estimates

summary(lm(Y~X))
```
