---
title: "Hierarchical clustering"
author: "Eli Clapper"
date: "29-12-2021"
output: html_document
---

Hierarchical clustering iteratively merges cases that have the smallest distance within the predictor space.

which linkage (single linkage)

So, after forming a cluster, we take the smallest/maximum eucledian distance of 1 or 5, to the next closest neighbour and that is the new eucledian distance for (1,5)

```{r}
set.seed(6164900)
X <- iris[c(1:5, 51:55, 101:105),1:4]

eucl <- function(C,N){
  sqrt(sum((C-N)^2))
}

dists <- matrix(0, nrow(X), nrow(X))
for(i in 1:nrow(X)){
  for(j in 1:nrow(X)){
    dists[i,j] <- eucl(X[i,], X[j,])
  }
}

diag(dists) <- Inf #dists[upper.tri(dists)] <- Inf
nclust <- nrow(dists)
groups <- matrix(NA, nrow(dists) - 1, 2)
j <- 1

while(nclust > 2){
  group <- sort(as.numeric(which(dists == min(dists), arr.ind = T)[1,]))
  groups[j,] <- group
  
  mindist <- dists[group[1], group[2]]
  
  seqal<- (1:nrow(dists))[!(1:nrow(dists)) %in% group]
  
  newdists <- c()
  
  for(i in seqal){
    val <- min(dists[group[1], i], dists[group[2], i])
    newdists <- append(newdists,val)
  }
  
  newdists <- c(newdists, Inf)
  nclust <- length(newdists)
  
  
  if(nclust <= 3){
    dists2 <- dists[,-c(group[1],group[2]), drop = F]
    dists2 <- dists2[-c(group[1],group[2]), ,drop = F]
  }else{
    dists2 <- dists[,-c(group[1],group[2])]
    dists2 <- dists2[-c(group[1],group[2]),]
  }
    
  dists3 <- matrix(Inf, nclust, nclust)
  dists3[1:(nclust-1), 1:(nclust-1)] <- dists2
  dists3[nclust, ] <- newdists
  dists3[, nclust] <- newdists
    
  dists <- dists3

  j <- j + 1
}
groups[(nrow(X)-1),] <- c(1,2)



# group <- as.numeric(which(dists == min(dists), arr.ind = T)[1,])
# mindist <- dists[group[1], group[2]]
# 
# seqal <- 1:nrow(dists)
# seqal<- 1:nrow(dists)[!1:nrow(dists) %in% group]
# 
# newdists <- c()
# #candidates <- c()
# for(i in seqal){
#   val <- min(dists[group[1], i], dists[group[2], i])
#   candidate <- as.numeric(which(dists - val == 0, arr.ind = T)[2])
#   #dists[candidate, i] <- val
#   #dists[i, candidate] <- val
#   newdists <- append(newdists,val)
#   #candidates <- append(candidates, candidate)
# }
# newdists <- c(newdists, Inf)
# #now we combine 1 and 5 and give every i, except (1,5) its new minimum distance
# nclust <- length(newdists)
# 
# nams <- c(paste0("C", seqal), paste0("C", group[1], group[2]))
# 
# dists2 <- dists[,-c(group[1],group[2])]
# dists2 <- dists2[-c(group[1],group[2]),]
# 
# dists3 <- matrix(Inf, nclust, nclust)
# dists3[1:(nclust-1), (nclust-1)] <- dists2
# dists3[nclust, ] <- newdists
# dists3[, nclust] <- newdists
# 
# colnames(dists3) <- nams
# 
# 
# 
# dists <- dists[1:3, 1:3]



# distsv <- sort(dists[upper.tri(dists)])
# 
# groups <- list()
# cases <- c()
# for(i in 1:length(distsv)){
#   group <- which(dists == distsv[i], arr.ind = T)
#   groups[[i]] <- group
#   cases <- append(cases, c(group[1], group[2]))
# }







```

